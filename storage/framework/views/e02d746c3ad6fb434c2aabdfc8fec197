<?php $__env->startSection('header'); ?>
    <?php echo $__env->make('util.m-topbar', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>
    <div class="container">
		<div class="col-lg-12">
			<ol class="breadcrumb" style=" margin-left: 1.5rem; ">
				<li><label>Inventory</label>
				<li><a href="<?php echo e(route('home')); ?>" class="active">Home</a></li>
				<li><label>Import Page</label>
			</ol>
		</div>
	</div>
<?php $__env->stopSection(); ?>

<?php $__env->startSection('content'); ?>
<div class="container">
	<div class="col-lg-3">
		<div class="btn-group-vertical col-lg-12" role="group">
			<a role="button" class="btn btn-default col-lg-12 text-left" href="<?php echo e(route('home')); ?>"><span class="glyphicon glyphicon-chevron-left"></span> Return to home</a>
		</div>
	</div>

	<div class="col-lg-9 col-md-offset-center-2">
		<div class="panel panel-default col-lg-12" style="border-color: #ccc;">
			<h3>Import Categories</h3>
			<hr/>
			<form id='frm_update' class='updte' enctype='multipart/form-data'>
				<input type='hidden' name='_method' value='POST'>
				<input type="file" name="xl" id="xl">
				<br/>
				<input id="submit" class="btn btn-primary" type="submit" value="Upload XLS">
			</form>
			<br/><br/>
			<div class="progress">
				<div class="progress-bar"  id="progress" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;">
					<label id="totalData" for="">0%</label>
				</div>
			</div>
			<label for="" id="timeEstimate">0:00</label>
		</div>
	</div>
 </div>
<?php $__env->stopSection(); ?>

<?php $__env->startSection('script'); ?>
<script>
	$.ajaxSetup({
	   headers: { 'X-CSRF-Token' : $('meta[name=_token]').attr('content') }
	})

	$(document).on('submit', 'form', function() {
		var size = $("#xl")[0].files[0].size;
		var progress = 0;
		var newPercent = 0;
		var data_failed_import = 0;
		var start = performance.now();
		var eta;

		function secondsToString(seconds) {
			var numyears = Math.floor(seconds / 31536000);
			var numdays = Math.floor((seconds % 31536000) / 86400);
			var numhours = Math.floor(((seconds % 31536000) % 86400) / 3600);
			var numminutes = Math.floor((((seconds % 31536000) % 86400) % 3600) / 60);
			var numseconds = (((seconds % 31536000) % 86400) % 3600) % 60;

			return document.getElementById("timeEstimate").innerHTML = numyears + " years " +  numdays + " days " + numhours + " hours " + numminutes + " minutes " + numseconds + " seconds";

		}

		Papa.parse($("#xl")[0].files[0], {
			header: true,
			dynamicTyping: true,
			skipEmptyLines: true,

			step: function(row) {
				var csvData = row.data[0];
				$.ajax({
					type: 'POST',
					url: "<?php echo e(route('import_categories')); ?>",
					data: csvData,
					success: function() {
						progress = row.meta.cursor;
						newPercent = Math.round(progress / size * 100);

						document.getElementById("progress").style.width = newPercent + "%";
						document.getElementById("totalData").innerHTML = newPercent + "%";

						eta = start - performance.now();;

						secondsToString(eta);

					},
					error: function() {
						data_failed_import++;
					}
				});
			},
			complete: function() {
				document.getElementById("totalData").innerHTML = "Data importing is finished";
			}
		});
		return false;
	});
</script>
<?php $__env->stopSection(); ?>
<?php echo $__env->make('app', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>