/*!
 * multilist v0.8.0
 * built 2014-04-24
 * Copyright (C) 2014 Nicholas Ortenzio and Jason Duncan
 * Released under the MIT license
 * http://jquery.org/license
 */
!function(a){Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e});var b="multilist",c="multilistitem",d={canRemove:!1,datalist:null,enableSearch:!0,initWithCallback:!0,labelText:"",maxSelected:10,closeOnMax:!1,onChange:function(){},onRemove:function(){},transitionSpeed:"fast",single:!1},e="selected",f="disabled",g="filtered",h="opened",i=[{type:"keyup",selector:'input[role="search"]',callback:function(a,c){var d=c.val().toLowerCase();a[b]("filter",d)}},{type:"click",selector:"a.label",callback:function(a,c,d){d.preventDefault(),a.hasClass(f)||a[b](a.hasClass(h)?"close":"open")}},{type:"click",selector:".items a",callback:function(c,d,g){g.preventDefault(),d.is("div")&&(d=d.parent());var h=c.data(b),i=d.attr("value"),j=d.text();h.single&&(h.$items.removeClass(e),a("span.labeltext",h.$label).text(j)),d.hasClass(f)||!d.hasClass(e)&&h.maxSelected>0&&m(c)>=h.maxSelected||(d.toggleClass(e),h.onChange(i,j,d.hasClass(e),c),h.maxSelected==m(c)&&h.closeOnMax&&c[b]("close"),c[b]("serialize"))}},{type:"click",selector:"a.remove",callback:function(a,c,d){d.preventDefault(),a[b]("remove",!0)}}];i.push({type:"click",selector:"div.label span.add",callback:function(b,c){a("a.label",c.parent()).trigger("click")}});var j={base:['<div class="inner">','  <div class="holder label {{if canRemove}}removable{{/if}}">','    <span class="ui-sprite add">+</span>','    <a href="#" class="label">','      <span class="labeltext">${labelText}</span>',"    </a>",'    {{if canRemove}}<a href="#" class="remove">x</a>{{/if}}',"  </div>","  {{if enableSearch}}",'  <div class="holder search">','    <input role="search" placeholder="Search" spellcheck="false" autocorrect="false" type="text" />',"  </div>","  {{/if}}",'  <div class="holder items">','    <ul role="listbox"></ul>',"  </div>","</div>",'<input type="hidden" name="${name}" />'].join(""),items:["<li>",'  <a href="#" role="option" value="${value}" class="item {{if selected}}selected{{/if}}" title="${description}" >','    {{if $item.renderCheckbox}}<div class="ui-sprite checkbox"></div>{{/if}}',"    ${text}","  </a>","</li>"].join("")};a.each(j,function(b,c){a.template(b,c)});var k={init:function(c){var e=a.extend({},d,c);return this.each(function(){var c=a(this).addClass(b).attr("role","listbox").attr("aria-multiselectable","true").show(),d=this,f=c.attr("name");if(a.tmpl("base",a.extend({},e,{name:f})).appendTo(c),a.each(i,function(a,b){c.on(b.type,b.selector,n.bind(d,b.callback))}),e.$this=c,e.$label=c.find(".holder.label"),e.$shold=c.find(".holder.search"),e.$search=c.find("input"),e.$holder=c.find(".holder.items"),e.$list=e.$holder.find("ul"),e.$hidden=c.find('input[name="'+f+'"]'),e.datalist){var g=a.tmpl("items",e.datalist,{renderCheckbox:!e.single});e.$list.empty().append(g)}e.single&&(e.closeOnMax=!0,e.maxSelected=1),e.$items=e.$list.find("a"),c.data(b,e)})},close:function(a,b){var c=a.hasClass(h);c&&(b.enableSearch&&(b.$shold.hide(),b.$search.val(""),b.$items.removeClass(g)),b.$holder.slideUp(b.transitionSpeed,function(){a.removeClass(h)}))},deselect:function(b,c,d,f){var g=c.$items.filter('[value="'+d+'"]');if(0!==g.length){g.removeClass(e).attr("aria-selected","false");var h=b.find("."+e).map(function(){return a(this).attr("value")}).splice(0).join("|");b.attr("value",h).attr("aria-valuetext",h),f&&c.onChange([],b)}},disable:function(a){a.addClass(f)},enable:function(a){a.removeClass(f)},filter:function(b,c,d){var e=c.$items;return d.length<3?void e.removeClass(g):void a.each(e,l.bind(this,d))},getSelected:function(b,c){var d=c.$items.filter("."+e),f=a.map(d,function(b){return a(b).attr("value")});return f},open:function(a,b){b.enableSearch&&(b.$shold.show(),b.$search.focus()),b.$holder.slideDown(b.transitionSpeed,function(){a.addClass(h)})},remove:function(a,b,c){c&&b.onRemove(a),a.remove()},serialize:function(b,c){var d=c.$items.filter("."+e),f=a.map(d,function(b){return a(b).attr("value")}).join("|");return b.attr("value",f).attr("aria-valuetext",f),c.$hidden.val(f),f},setValue:function(a,c,d,f){var g=d.split("|");for(var h in g)c.$items.filter('[value="'+g[h]+'"]').addClass(e).attr("aria-selected","true");var i=a[b]("serialize");f&&c.onChange(i,a)},updateItems:function(a,b){b.$items=a.find("> ul > li > a"),k.setLabel(data)}},l=function(b,d,e){var f=a(e),h=f.attr("value").toLowerCase(),i=f.text().toLowerCase(),j=f.data(c);if(h.indexOf(b)>-1)return void f.removeClass(g);if(i.indexOf(b)>-1)return void f.removeClass(g);if(j&&j.fields)for(var k=0;k<j.fields.length;k+=1){var l=j.fields[k].toLowerCase();if(l.indexOf(b)>-1)return void f.removeClass(g)}f.addClass(g)},m=function(a){return a.find("."+e).length},n=function(b,c){var d=a(this),e=a(c.target);b(d,e,c)};a.fn[b]=function(c){if(k[c]){var d=a(this),e=d.data(b),f=[d,e].concat(Array.prototype.slice.call(arguments,1));return k[c].apply(this,f)}return"object"!=typeof c&&c?void a.error("Method "+c+" does not exist"):k.init.apply(this,arguments)}}(jQuery);